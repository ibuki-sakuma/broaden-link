<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security6">
<head th:replace="~{layout :: common_head('BroadenLink - Broaden')}">
</head>
<body>
    <div th:replace="~{layout :: navbar}"></div>
    <div class="container d-flex flex-column justify-content-center align-items-center">
        <div class="text-center mb-3 mt-5">
            <p class="text-muted">
                他ユーザがブックマークしているサイトをランダム表示します。<br>
                あなたの知識の幅を広げるきっかけを見つけましょう。
            </p>
        </div>
        <div class="info-text mb-2" style="max-width: 500px; width: 100%; text-align: left;">公開ブックマーク数: <span th:text="${publicBookmarkCount}">0</span>件</div>

        <div th:if="${broadenItem == null}" class="text-center d-flex flex-column align-items-center">
            <p class="text-muted mb-3 speech-bubble-text">
                現在、表示できるブックマークがありません。<br>ユニークユーザーが2以上のブックマークが増えると表示されます。
            </p>
            <img th:src="@{/images/no_items_illustration.png}" alt="No Bookmarks" style="width: 150px; height: 150px; opacity: 0.7;" />
        </div>
        <div th:if="${broadenItem != null}" class="card text-center py-2" style="max-width: 500px; width: 100%;">
            <div class="card-body">
                <img th:if="${broadenItem.displayFaviconUrl}" th:src="${broadenItem.displayFaviconUrl}" alt="Favicon" class="mb-4" style="width: 48px; height: 48px;" onerror="this.onerror=null;this.src='/images/default_favicon.png';" />
                <img th:unless="${broadenItem.displayFaviconUrl}" src="/images/default_favicon.png" alt="Default Favicon" class="mb-4" style="width: 48px; height: 48px;" />
                <h2 class="card-title mb-3 fw-bold" th:text="${broadenItem.title ?: 'No Title'}" style="font-size: 2rem;">Bookmark Title</h2>
                <p class="card-text text-muted mb-2">
                    <a th:href="${broadenItem.url ?: '#'}" target="_blank" style="font-size: 1rem; text-decoration: underline; color: inherit;">
                        <span th:text="${broadenItem.url ?: 'No URL'}"></span>
                        <i class="bi bi-box-arrow-up-right ms-2"></i>
                    </a>
                </p>
                <p class="card-text text-muted" style="font-size: 0.9em;">総合スコア: <span th:text="${broadenItem.countValue}"></span></p>
                <div class="d-flex justify-content-center">
                    <button type="button" class="btn btn-link p-0 icon-button-wrapper broaden-icon-button-wrapper me-4" data-bs-toggle="modal" data-bs-target="#addBookmarkFromBroadenModal" th:data-url="${broadenItem.url}" th:data-title="${broadenItem.title}" th:disabled="${broadenItem.bookmarked}" title="自分のブックマークに追加" sec:authorize="isAuthenticated()">
                        <i th:class="${broadenItem.bookmarked} ? 'bi bi-bookmark-check-fill fs-4 text-secondary' : 'bi bi-bookmark-plus fs-4 text-secondary'"></i>
                    </button>
                    <button type="button" class="btn btn-link p-0 icon-button-wrapper broaden-icon-button-wrapper" onclick="location.reload();" title="別のブックマークを見る">
                        <i class="bi bi-arrow-clockwise fs-4 text-secondary"></i>
                    </button>
                </div>
            </div>
        </div>
        <div class="info-text mt-1" style="max-width: 500px; width: 100%; text-align: center;">
            <a th:href="@{/ranking}" class="text-decoration-none">人気のブックマークをもっと見る <i class="bi bi-arrow-right-circle"></i></a>
        </div>
    </div>
    <div th:replace="~{layout :: footer}"></div>
    <div th:replace="~{fragments/change_password_modal :: change_password_modal}"></div>
    <div th:replace="~{fragments/add_bookmark_from_broaden_modal :: add_bookmark_from_broaden_modal}"></div>
    <div th:replace="~{fragments/delete_account_modal :: delete_account_modal}"></div>
    <script th:src="@{/js/main.js}"></script>
    <script th:if="${error != null}" th:inline="javascript">
        document.addEventListener('DOMContentLoaded', function() {
            var targetModal = new bootstrap.Modal(document.getElementById('addBookmarkFromBroadenModal'));
            targetModal.show();
        });
    </script>
</body>